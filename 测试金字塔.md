# 测试金字塔

## 🔺 层级结构

```
                    ▲
                   /E\              5️⃣ E2E 端到端测试
                  /2E \                 (最慢、最全面)
                 /-----\
                /       \           4️⃣ 视觉回归测试
               / Visual  \              (Chromatic)
              /-----------\
             /             \        3️⃣ 可访问性测试
            /     A11y      \           (a11y)
           /-----------------\
          /                   \     2️⃣ 交互测试
         /    Interaction      \        (play 函数)
        /-----------------------\
       /                         \  1️⃣ 渲染测试
      /         Render            \     (最快、最基础)
     /-----------------------------\
```

## 📊 测试层级详解

| 层级 | 测试类型 | 命令 | 速度 | 目的 |
|:----:|----------|------|:----:|------|
| 1️⃣ | **渲染测试** | `npm run test:render` | ⚡ 快 | 组件是否正确显示 |
| 2️⃣ | **交互测试** | `npm run test:interaction` | 🔄 中 | 用户操作是否正常 |
| 3️⃣ | **可访问性测试** | `npm run test:a11y` | 🔄 中 | 是否符合无障碍标准 |
| 4️⃣ | **视觉回归测试** | `npm run chromatic` | 🐢 慢 | UI 外观是否有变化 |
| 5️⃣ | **E2E 端到端测试** | `npm run test:e2e` | 🐢 最慢 | 完整用户流程是否正常 |

---

## 📖 概念说明

### 1️⃣ 渲染测试 (Render Test)
> 验证组件在不同 props 下能否正确渲染

- **测试内容**：组件显示、样式变体、不同尺寸
- **不包含**：用户交互、点击事件
- **示例**：Primary 按钮是否显示蓝色背景

### 2️⃣ 交互测试 (Interaction Test)
> 模拟用户操作，验证组件响应是否正确

- **测试内容**：点击、输入、悬停等用户行为
- **使用**：Storybook `play` 函数
- **示例**：点击按钮后 onClick 是否被调用

### 3️⃣ 可访问性测试 (A11y Test)
> 检查组件是否符合 WCAG 无障碍标准

- **测试内容**：屏幕阅读器支持、键盘导航、颜色对比度
- **使用**：axe-core 自动检测
- **示例**：按钮是否有 aria-label

### 4️⃣ 视觉回归测试 (Visual Test)
> 检测 UI 外观是否发生意外变化

- **测试内容**：像素级别的 UI 对比
- **使用**：Chromatic 云服务
- **示例**：按钮颜色是否从蓝色变成了红色

### 5️⃣ E2E 端到端测试 (End-to-End Test)
> 模拟真实用户在浏览器中的完整操作流程

- **测试内容**：跨页面、跨组件的完整业务流程
- **使用**：Playwright 多浏览器测试
- **示例**：用户登录 → 创建任务 → 完成任务

---

## ⚡ 执行顺序（CI/CD）

```
install-cache
      │
      ├──→ test-render ────────→ ⚡ 快速反馈
      │
      ├──→ test-interaction ───→ 🔄 功能验证
      │
      ├──→ test-a11y ──────────→ ♿ 无障碍检查
      │
      ├──→ test-chromatic ─────→ 🎨 视觉对比
      │
      └──→ test-e2e ───────────→ 🎭 全流程验证
           (chromium/firefox/webkit)
```

---

## 🎯 测试策略

| 原则 | 说明 |
|------|------|
| **金字塔底层多** | 渲染/交互测试数量最多，速度快 |
| **金字塔顶层少** | E2E 测试数量少，覆盖关键流程 |
| **快速失败** | 基础测试先跑，快速发现问题 |
| **并行执行** | CI 中各测试并行运行，节省时间 |

